{"ast":null,"code":"import { ONE_SECOND } from '@datadog/browser-core';\nimport { elementMatches } from '../../browser/polyfills';\nvar MIN_CLICKS_PER_SECOND_TO_CONSIDER_RAGE = 3;\nexport function computeFrustration(clicks, rageClick) {\n  if (isRage(clicks)) {\n    rageClick.addFrustration(\"rage_click\" /* FrustrationType.RAGE_CLICK */);\n    if (clicks.some(isDead)) {\n      rageClick.addFrustration(\"dead_click\" /* FrustrationType.DEAD_CLICK */);\n    }\n    if (rageClick.hasError) {\n      rageClick.addFrustration(\"error_click\" /* FrustrationType.ERROR_CLICK */);\n    }\n    return {\n      isRage: true\n    };\n  }\n  var hasSelectionChanged = clicks.some(function (click) {\n    return click.getUserActivity().selection;\n  });\n  clicks.forEach(function (click) {\n    if (click.hasError) {\n      click.addFrustration(\"error_click\" /* FrustrationType.ERROR_CLICK */);\n    }\n    if (isDead(click) &&\n    // Avoid considering clicks part of a double-click or triple-click selections as dead clicks\n    !hasSelectionChanged) {\n      click.addFrustration(\"dead_click\" /* FrustrationType.DEAD_CLICK */);\n    }\n  });\n  return {\n    isRage: false\n  };\n}\nexport function isRage(clicks) {\n  if (clicks.some(function (click) {\n    return click.getUserActivity().selection || click.getUserActivity().scroll;\n  })) {\n    return false;\n  }\n  for (var i = 0; i < clicks.length - (MIN_CLICKS_PER_SECOND_TO_CONSIDER_RAGE - 1); i += 1) {\n    if (clicks[i + MIN_CLICKS_PER_SECOND_TO_CONSIDER_RAGE - 1].event.timeStamp - clicks[i].event.timeStamp <= ONE_SECOND) {\n      return true;\n    }\n  }\n  return false;\n}\nvar DEAD_CLICK_EXCLUDE_SELECTOR =\n// inputs that don't trigger a meaningful event like \"input\" when clicked, including textual\n// inputs (using a negative selector is shorter here)\n'input:not([type=\"checkbox\"]):not([type=\"radio\"]):not([type=\"button\"]):not([type=\"submit\"]):not([type=\"reset\"]):not([type=\"range\"]),' + 'textarea,' + 'select,' +\n// contenteditable and their descendants don't always trigger meaningful changes when manipulated\n'[contenteditable],' + '[contenteditable] *,' +\n// canvas, as there is no good way to detect activity occurring on them\n'canvas,' +\n// links that are interactive (have an href attribute) or any of their descendants, as they can\n// open a new tab or navigate to a hash without triggering a meaningful event\n'a[href],' + 'a[href] *';\nexport function isDead(click) {\n  if (click.hasPageActivity || click.getUserActivity().input || click.getUserActivity().scroll) {\n    return false;\n  }\n  return !elementMatches(click.event.target, DEAD_CLICK_EXCLUDE_SELECTOR);\n}","map":{"version":3,"names":["ONE_SECOND","elementMatches","MIN_CLICKS_PER_SECOND_TO_CONSIDER_RAGE","computeFrustration","clicks","rageClick","isRage","addFrustration","some","isDead","hasError","hasSelectionChanged","click","getUserActivity","selection","forEach","scroll","i","length","event","timeStamp","DEAD_CLICK_EXCLUDE_SELECTOR","hasPageActivity","input","target"],"sources":["D:\\edu'\\Spritle\\spritle\\node_modules\\@datadog\\browser-rum-core\\src\\domain\\action\\computeFrustration.ts"],"sourcesContent":["import { ONE_SECOND } from '@datadog/browser-core'\nimport { FrustrationType } from '../../rawRumEvent.types'\nimport { elementMatches } from '../../browser/polyfills'\nimport type { Click } from './trackClickActions'\n\nconst MIN_CLICKS_PER_SECOND_TO_CONSIDER_RAGE = 3\n\nexport function computeFrustration(clicks: Click[], rageClick: Click) {\n  if (isRage(clicks)) {\n    rageClick.addFrustration(FrustrationType.RAGE_CLICK)\n    if (clicks.some(isDead)) {\n      rageClick.addFrustration(FrustrationType.DEAD_CLICK)\n    }\n    if (rageClick.hasError) {\n      rageClick.addFrustration(FrustrationType.ERROR_CLICK)\n    }\n    return { isRage: true }\n  }\n\n  const hasSelectionChanged = clicks.some((click) => click.getUserActivity().selection)\n  clicks.forEach((click) => {\n    if (click.hasError) {\n      click.addFrustration(FrustrationType.ERROR_CLICK)\n    }\n    if (\n      isDead(click) &&\n      // Avoid considering clicks part of a double-click or triple-click selections as dead clicks\n      !hasSelectionChanged\n    ) {\n      click.addFrustration(FrustrationType.DEAD_CLICK)\n    }\n  })\n  return { isRage: false }\n}\n\nexport function isRage(clicks: Click[]) {\n  if (clicks.some((click) => click.getUserActivity().selection || click.getUserActivity().scroll)) {\n    return false\n  }\n  for (let i = 0; i < clicks.length - (MIN_CLICKS_PER_SECOND_TO_CONSIDER_RAGE - 1); i += 1) {\n    if (\n      clicks[i + MIN_CLICKS_PER_SECOND_TO_CONSIDER_RAGE - 1].event.timeStamp - clicks[i].event.timeStamp <=\n      ONE_SECOND\n    ) {\n      return true\n    }\n  }\n  return false\n}\n\nconst DEAD_CLICK_EXCLUDE_SELECTOR =\n  // inputs that don't trigger a meaningful event like \"input\" when clicked, including textual\n  // inputs (using a negative selector is shorter here)\n  'input:not([type=\"checkbox\"]):not([type=\"radio\"]):not([type=\"button\"]):not([type=\"submit\"]):not([type=\"reset\"]):not([type=\"range\"]),' +\n  'textarea,' +\n  'select,' +\n  // contenteditable and their descendants don't always trigger meaningful changes when manipulated\n  '[contenteditable],' +\n  '[contenteditable] *,' +\n  // canvas, as there is no good way to detect activity occurring on them\n  'canvas,' +\n  // links that are interactive (have an href attribute) or any of their descendants, as they can\n  // open a new tab or navigate to a hash without triggering a meaningful event\n  'a[href],' +\n  'a[href] *'\n\nexport function isDead(click: Click) {\n  if (click.hasPageActivity || click.getUserActivity().input || click.getUserActivity().scroll) {\n    return false\n  }\n  return !elementMatches(click.event.target, DEAD_CLICK_EXCLUDE_SELECTOR)\n}\n"],"mappings":"AAAA,SAASA,UAAU,QAAQ,uBAAuB;AAElD,SAASC,cAAc,QAAQ,yBAAyB;AAGxD,IAAMC,sCAAsC,GAAG,CAAC;AAEhD,OAAM,SAAUC,kBAAkBA,CAACC,MAAe,EAAEC,SAAgB;EAClE,IAAIC,MAAM,CAACF,MAAM,CAAC,EAAE;IAClBC,SAAS,CAACE,cAAc,+CAA4B;IACpD,IAAIH,MAAM,CAACI,IAAI,CAACC,MAAM,CAAC,EAAE;MACvBJ,SAAS,CAACE,cAAc,+CAA4B;IACtD;IACA,IAAIF,SAAS,CAACK,QAAQ,EAAE;MACtBL,SAAS,CAACE,cAAc,iDAA6B;IACvD;IACA,OAAO;MAAED,MAAM,EAAE;IAAI,CAAE;EACzB;EAEA,IAAMK,mBAAmB,GAAGP,MAAM,CAACI,IAAI,CAAC,UAACI,KAAK;IAAK,OAAAA,KAAK,CAACC,eAAe,EAAE,CAACC,SAAS;EAAjC,CAAiC,CAAC;EACrFV,MAAM,CAACW,OAAO,CAAC,UAACH,KAAK;IACnB,IAAIA,KAAK,CAACF,QAAQ,EAAE;MAClBE,KAAK,CAACL,cAAc,iDAA6B;IACnD;IACA,IACEE,MAAM,CAACG,KAAK,CAAC;IACb;IACA,CAACD,mBAAmB,EACpB;MACAC,KAAK,CAACL,cAAc,+CAA4B;IAClD;EACF,CAAC,CAAC;EACF,OAAO;IAAED,MAAM,EAAE;EAAK,CAAE;AAC1B;AAEA,OAAM,SAAUA,MAAMA,CAACF,MAAe;EACpC,IAAIA,MAAM,CAACI,IAAI,CAAC,UAACI,KAAK;IAAK,OAAAA,KAAK,CAACC,eAAe,EAAE,CAACC,SAAS,IAAIF,KAAK,CAACC,eAAe,EAAE,CAACG,MAAM;EAAnE,CAAmE,CAAC,EAAE;IAC/F,OAAO,KAAK;EACd;EACA,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGb,MAAM,CAACc,MAAM,IAAIhB,sCAAsC,GAAG,CAAC,CAAC,EAAEe,CAAC,IAAI,CAAC,EAAE;IACxF,IACEb,MAAM,CAACa,CAAC,GAAGf,sCAAsC,GAAG,CAAC,CAAC,CAACiB,KAAK,CAACC,SAAS,GAAGhB,MAAM,CAACa,CAAC,CAAC,CAACE,KAAK,CAACC,SAAS,IAClGpB,UAAU,EACV;MACA,OAAO,IAAI;IACb;EACF;EACA,OAAO,KAAK;AACd;AAEA,IAAMqB,2BAA2B;AAC/B;AACA;AACA,qIAAqI,GACrI,WAAW,GACX,SAAS;AACT;AACA,oBAAoB,GACpB,sBAAsB;AACtB;AACA,SAAS;AACT;AACA;AACA,UAAU,GACV,WAAW;AAEb,OAAM,SAAUZ,MAAMA,CAACG,KAAY;EACjC,IAAIA,KAAK,CAACU,eAAe,IAAIV,KAAK,CAACC,eAAe,EAAE,CAACU,KAAK,IAAIX,KAAK,CAACC,eAAe,EAAE,CAACG,MAAM,EAAE;IAC5F,OAAO,KAAK;EACd;EACA,OAAO,CAACf,cAAc,CAACW,KAAK,CAACO,KAAK,CAACK,MAAM,EAAEH,2BAA2B,CAAC;AACzE","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
{"ast":null,"code":"import { ONE_SECOND, clearTimeout, setTimeout } from '@datadog/browser-core';\nexport var MAX_DURATION_BETWEEN_CLICKS = ONE_SECOND;\nexport var MAX_DISTANCE_BETWEEN_CLICKS = 100;\nexport function createClickChain(firstClick, onFinalize) {\n  var bufferedClicks = [];\n  var status = 0 /* ClickChainStatus.WaitingForMoreClicks */;\n  var maxDurationBetweenClicksTimeoutId;\n  appendClick(firstClick);\n  function appendClick(click) {\n    click.stopObservable.subscribe(tryFinalize);\n    bufferedClicks.push(click);\n    clearTimeout(maxDurationBetweenClicksTimeoutId);\n    maxDurationBetweenClicksTimeoutId = setTimeout(dontAcceptMoreClick, MAX_DURATION_BETWEEN_CLICKS);\n  }\n  function tryFinalize() {\n    if (status === 1 /* ClickChainStatus.WaitingForClicksToStop */ && bufferedClicks.every(function (click) {\n      return click.isStopped();\n    })) {\n      status = 2 /* ClickChainStatus.Finalized */;\n      onFinalize(bufferedClicks);\n    }\n  }\n  function dontAcceptMoreClick() {\n    clearTimeout(maxDurationBetweenClicksTimeoutId);\n    if (status === 0 /* ClickChainStatus.WaitingForMoreClicks */) {\n      status = 1 /* ClickChainStatus.WaitingForClicksToStop */;\n      tryFinalize();\n    }\n  }\n  return {\n    tryAppend: function (click) {\n      if (status !== 0 /* ClickChainStatus.WaitingForMoreClicks */) {\n        return false;\n      }\n      if (bufferedClicks.length > 0 && !areEventsSimilar(bufferedClicks[bufferedClicks.length - 1].event, click.event)) {\n        dontAcceptMoreClick();\n        return false;\n      }\n      appendClick(click);\n      return true;\n    },\n    stop: function () {\n      dontAcceptMoreClick();\n    }\n  };\n}\n/**\n * Checks whether two events are similar by comparing their target, position and timestamp\n */\nfunction areEventsSimilar(first, second) {\n  return first.target === second.target && mouseEventDistance(first, second) <= MAX_DISTANCE_BETWEEN_CLICKS && first.timeStamp - second.timeStamp <= MAX_DURATION_BETWEEN_CLICKS;\n}\nfunction mouseEventDistance(origin, other) {\n  return Math.sqrt(Math.pow(origin.clientX - other.clientX, 2) + Math.pow(origin.clientY - other.clientY, 2));\n}","map":{"version":3,"names":["ONE_SECOND","clearTimeout","setTimeout","MAX_DURATION_BETWEEN_CLICKS","MAX_DISTANCE_BETWEEN_CLICKS","createClickChain","firstClick","onFinalize","bufferedClicks","status","maxDurationBetweenClicksTimeoutId","appendClick","click","stopObservable","subscribe","tryFinalize","push","dontAcceptMoreClick","every","isStopped","tryAppend","length","areEventsSimilar","event","stop","first","second","target","mouseEventDistance","timeStamp","origin","other","Math","sqrt","pow","clientX","clientY"],"sources":["D:\\edu'\\Spritle\\Spritle\\node_modules\\@datadog\\browser-rum-core\\src\\domain\\action\\clickChain.ts"],"sourcesContent":["import type { TimeoutId } from '@datadog/browser-core'\nimport { ONE_SECOND, clearTimeout, setTimeout } from '@datadog/browser-core'\nimport type { Click } from './trackClickActions'\n\nexport interface ClickChain {\n  tryAppend: (click: Click) => boolean\n  stop: () => void\n}\n\nexport const MAX_DURATION_BETWEEN_CLICKS = ONE_SECOND\nexport const MAX_DISTANCE_BETWEEN_CLICKS = 100\n\nconst enum ClickChainStatus {\n  WaitingForMoreClicks,\n  WaitingForClicksToStop,\n  Finalized,\n}\n\nexport function createClickChain(firstClick: Click, onFinalize: (clicks: Click[]) => void): ClickChain {\n  const bufferedClicks: Click[] = []\n  let status = ClickChainStatus.WaitingForMoreClicks\n  let maxDurationBetweenClicksTimeoutId: TimeoutId | undefined\n  appendClick(firstClick)\n\n  function appendClick(click: Click) {\n    click.stopObservable.subscribe(tryFinalize)\n    bufferedClicks.push(click)\n    clearTimeout(maxDurationBetweenClicksTimeoutId)\n    maxDurationBetweenClicksTimeoutId = setTimeout(dontAcceptMoreClick, MAX_DURATION_BETWEEN_CLICKS)\n  }\n\n  function tryFinalize() {\n    if (status === ClickChainStatus.WaitingForClicksToStop && bufferedClicks.every((click) => click.isStopped())) {\n      status = ClickChainStatus.Finalized\n      onFinalize(bufferedClicks)\n    }\n  }\n\n  function dontAcceptMoreClick() {\n    clearTimeout(maxDurationBetweenClicksTimeoutId)\n    if (status === ClickChainStatus.WaitingForMoreClicks) {\n      status = ClickChainStatus.WaitingForClicksToStop\n      tryFinalize()\n    }\n  }\n\n  return {\n    tryAppend: (click) => {\n      if (status !== ClickChainStatus.WaitingForMoreClicks) {\n        return false\n      }\n\n      if (\n        bufferedClicks.length > 0 &&\n        !areEventsSimilar(bufferedClicks[bufferedClicks.length - 1].event, click.event)\n      ) {\n        dontAcceptMoreClick()\n        return false\n      }\n\n      appendClick(click)\n      return true\n    },\n    stop: () => {\n      dontAcceptMoreClick()\n    },\n  }\n}\n\n/**\n * Checks whether two events are similar by comparing their target, position and timestamp\n */\nfunction areEventsSimilar(first: MouseEvent, second: MouseEvent) {\n  return (\n    first.target === second.target &&\n    mouseEventDistance(first, second) <= MAX_DISTANCE_BETWEEN_CLICKS &&\n    first.timeStamp - second.timeStamp <= MAX_DURATION_BETWEEN_CLICKS\n  )\n}\n\nfunction mouseEventDistance(origin: MouseEvent, other: MouseEvent) {\n  return Math.sqrt(Math.pow(origin.clientX - other.clientX, 2) + Math.pow(origin.clientY - other.clientY, 2))\n}\n"],"mappings":"AACA,SAASA,UAAU,EAAEC,YAAY,EAAEC,UAAU,QAAQ,uBAAuB;AAQ5E,OAAO,IAAMC,2BAA2B,GAAGH,UAAU;AACrD,OAAO,IAAMI,2BAA2B,GAAG,GAAG;AAQ9C,OAAM,SAAUC,gBAAgBA,CAACC,UAAiB,EAAEC,UAAqC;EACvF,IAAMC,cAAc,GAAY,EAAE;EAClC,IAAIC,MAAM;EACV,IAAIC,iCAAwD;EAC5DC,WAAW,CAACL,UAAU,CAAC;EAEvB,SAASK,WAAWA,CAACC,KAAY;IAC/BA,KAAK,CAACC,cAAc,CAACC,SAAS,CAACC,WAAW,CAAC;IAC3CP,cAAc,CAACQ,IAAI,CAACJ,KAAK,CAAC;IAC1BX,YAAY,CAACS,iCAAiC,CAAC;IAC/CA,iCAAiC,GAAGR,UAAU,CAACe,mBAAmB,EAAEd,2BAA2B,CAAC;EAClG;EAEA,SAASY,WAAWA,CAAA;IAClB,IAAIN,MAAM,wDAAgDD,cAAc,CAACU,KAAK,CAAC,UAACN,KAAK;MAAK,OAAAA,KAAK,CAACO,SAAS,EAAE;IAAjB,CAAiB,CAAC,EAAE;MAC5GV,MAAM;MACNF,UAAU,CAACC,cAAc,CAAC;IAC5B;EACF;EAEA,SAASS,mBAAmBA,CAAA;IAC1BhB,YAAY,CAACS,iCAAiC,CAAC;IAC/C,IAAID,MAAM,oDAA4C;MACpDA,MAAM;MACNM,WAAW,EAAE;IACf;EACF;EAEA,OAAO;IACLK,SAAS,EAAE,SAAAA,CAACR,KAAK;MACf,IAAIH,MAAM,oDAA4C;QACpD,OAAO,KAAK;MACd;MAEA,IACED,cAAc,CAACa,MAAM,GAAG,CAAC,IACzB,CAACC,gBAAgB,CAACd,cAAc,CAACA,cAAc,CAACa,MAAM,GAAG,CAAC,CAAC,CAACE,KAAK,EAAEX,KAAK,CAACW,KAAK,CAAC,EAC/E;QACAN,mBAAmB,EAAE;QACrB,OAAO,KAAK;MACd;MAEAN,WAAW,CAACC,KAAK,CAAC;MAClB,OAAO,IAAI;IACb,CAAC;IACDY,IAAI,EAAE,SAAAA,CAAA;MACJP,mBAAmB,EAAE;IACvB;GACD;AACH;AAEA;;;AAGA,SAASK,gBAAgBA,CAACG,KAAiB,EAAEC,MAAkB;EAC7D,OACED,KAAK,CAACE,MAAM,KAAKD,MAAM,CAACC,MAAM,IAC9BC,kBAAkB,CAACH,KAAK,EAAEC,MAAM,CAAC,IAAItB,2BAA2B,IAChEqB,KAAK,CAACI,SAAS,GAAGH,MAAM,CAACG,SAAS,IAAI1B,2BAA2B;AAErE;AAEA,SAASyB,kBAAkBA,CAACE,MAAkB,EAAEC,KAAiB;EAC/D,OAAOC,IAAI,CAACC,IAAI,CAACD,IAAI,CAACE,GAAG,CAACJ,MAAM,CAACK,OAAO,GAAGJ,KAAK,CAACI,OAAO,EAAE,CAAC,CAAC,GAAGH,IAAI,CAACE,GAAG,CAACJ,MAAM,CAACM,OAAO,GAAGL,KAAK,CAACK,OAAO,EAAE,CAAC,CAAC,CAAC;AAC7G","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
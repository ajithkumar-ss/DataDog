{"ast":null,"code":"import { sendToExtension } from '@datadog/browser-core';\nimport * as replayStats from '../replayStats';\nimport { trackFocus, trackFrustration, trackInput, trackMediaInteraction, trackMouseInteraction, trackMove, trackMutation, trackScroll, trackStyleSheet, trackViewEnd, trackViewportResize } from './trackers';\nimport { createElementsScrollPositions } from './elementsScrollPositions';\nimport { initShadowRootsController } from './shadowRootsController';\nimport { startFullSnapshots } from './startFullSnapshots';\nimport { initRecordIds } from './recordIds';\nexport function record(options) {\n  var emit = options.emit,\n    configuration = options.configuration,\n    lifeCycle = options.lifeCycle;\n  // runtime checks for user options\n  if (!emit) {\n    throw new Error('emit function is required');\n  }\n  var emitAndComputeStats = function (record) {\n    emit(record);\n    sendToExtension('record', {\n      record: record\n    });\n    var view = options.viewContexts.findView();\n    replayStats.addRecord(view.id);\n  };\n  var elementsScrollPositions = createElementsScrollPositions();\n  var shadowRootsController = initShadowRootsController(configuration, emitAndComputeStats, elementsScrollPositions);\n  var stopFullSnapshots = startFullSnapshots(elementsScrollPositions, shadowRootsController, lifeCycle, configuration, flushMutations, function (records) {\n    return records.forEach(function (record) {\n      return emitAndComputeStats(record);\n    });\n  }).stop;\n  function flushMutations() {\n    shadowRootsController.flush();\n    mutationTracker.flush();\n  }\n  var recordIds = initRecordIds();\n  var mutationTracker = trackMutation(emitAndComputeStats, configuration, shadowRootsController, document);\n  var trackers = [mutationTracker, trackMove(configuration, emitAndComputeStats), trackMouseInteraction(configuration, emitAndComputeStats, recordIds), trackScroll(configuration, emitAndComputeStats, elementsScrollPositions, document), trackViewportResize(configuration, emitAndComputeStats), trackInput(configuration, emitAndComputeStats), trackMediaInteraction(configuration, emitAndComputeStats), trackStyleSheet(emitAndComputeStats), trackFocus(configuration, emitAndComputeStats), trackViewportResize(configuration, emitAndComputeStats), trackFrustration(lifeCycle, emitAndComputeStats, recordIds), trackViewEnd(lifeCycle, function (viewEndRecord) {\n    flushMutations();\n    emitAndComputeStats(viewEndRecord);\n  })];\n  return {\n    stop: function () {\n      shadowRootsController.stop();\n      trackers.forEach(function (tracker) {\n        return tracker.stop();\n      });\n      stopFullSnapshots();\n    },\n    flushMutations: flushMutations,\n    shadowRootsController: shadowRootsController\n  };\n}","map":{"version":3,"names":["sendToExtension","replayStats","trackFocus","trackFrustration","trackInput","trackMediaInteraction","trackMouseInteraction","trackMove","trackMutation","trackScroll","trackStyleSheet","trackViewEnd","trackViewportResize","createElementsScrollPositions","initShadowRootsController","startFullSnapshots","initRecordIds","record","options","emit","configuration","lifeCycle","Error","emitAndComputeStats","view","viewContexts","findView","addRecord","id","elementsScrollPositions","shadowRootsController","stopFullSnapshots","flushMutations","records","forEach","stop","flush","mutationTracker","recordIds","document","trackers","viewEndRecord","tracker"],"sources":["D:\\edu'\\Spritle\\Spritle\\node_modules\\@datadog\\browser-rum\\src\\domain\\record\\record.ts"],"sourcesContent":["import { sendToExtension } from '@datadog/browser-core'\nimport type { LifeCycle, RumConfiguration, ViewContexts } from '@datadog/browser-rum-core'\nimport type { BrowserRecord } from '../../types'\nimport * as replayStats from '../replayStats'\nimport type { Tracker } from './trackers'\nimport {\n  trackFocus,\n  trackFrustration,\n  trackInput,\n  trackMediaInteraction,\n  trackMouseInteraction,\n  trackMove,\n  trackMutation,\n  trackScroll,\n  trackStyleSheet,\n  trackViewEnd,\n  trackViewportResize,\n} from './trackers'\nimport { createElementsScrollPositions } from './elementsScrollPositions'\nimport type { ShadowRootsController } from './shadowRootsController'\nimport { initShadowRootsController } from './shadowRootsController'\nimport { startFullSnapshots } from './startFullSnapshots'\nimport { initRecordIds } from './recordIds'\n\nexport interface RecordOptions {\n  emit?: (record: BrowserRecord) => void\n  configuration: RumConfiguration\n  lifeCycle: LifeCycle\n  viewContexts: ViewContexts\n}\n\nexport interface RecordAPI {\n  stop: () => void\n  flushMutations: () => void\n  shadowRootsController: ShadowRootsController\n}\n\nexport function record(options: RecordOptions): RecordAPI {\n  const { emit, configuration, lifeCycle } = options\n  // runtime checks for user options\n  if (!emit) {\n    throw new Error('emit function is required')\n  }\n\n  const emitAndComputeStats = (record: BrowserRecord) => {\n    emit(record)\n    sendToExtension('record', { record })\n    const view = options.viewContexts.findView()!\n    replayStats.addRecord(view.id)\n  }\n\n  const elementsScrollPositions = createElementsScrollPositions()\n\n  const shadowRootsController = initShadowRootsController(configuration, emitAndComputeStats, elementsScrollPositions)\n\n  const { stop: stopFullSnapshots } = startFullSnapshots(\n    elementsScrollPositions,\n    shadowRootsController,\n    lifeCycle,\n    configuration,\n    flushMutations,\n    (records) => records.forEach((record) => emitAndComputeStats(record))\n  )\n\n  function flushMutations() {\n    shadowRootsController.flush()\n    mutationTracker.flush()\n  }\n\n  const recordIds = initRecordIds()\n  const mutationTracker = trackMutation(emitAndComputeStats, configuration, shadowRootsController, document)\n  const trackers: Tracker[] = [\n    mutationTracker,\n    trackMove(configuration, emitAndComputeStats),\n    trackMouseInteraction(configuration, emitAndComputeStats, recordIds),\n    trackScroll(configuration, emitAndComputeStats, elementsScrollPositions, document),\n    trackViewportResize(configuration, emitAndComputeStats),\n    trackInput(configuration, emitAndComputeStats),\n    trackMediaInteraction(configuration, emitAndComputeStats),\n    trackStyleSheet(emitAndComputeStats),\n    trackFocus(configuration, emitAndComputeStats),\n    trackViewportResize(configuration, emitAndComputeStats),\n    trackFrustration(lifeCycle, emitAndComputeStats, recordIds),\n    trackViewEnd(lifeCycle, (viewEndRecord) => {\n      flushMutations()\n      emitAndComputeStats(viewEndRecord)\n    }),\n  ]\n\n  return {\n    stop: () => {\n      shadowRootsController.stop()\n      trackers.forEach((tracker) => tracker.stop())\n      stopFullSnapshots()\n    },\n    flushMutations,\n    shadowRootsController,\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
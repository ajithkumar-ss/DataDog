{"ast":null,"code":"import { generateUUID } from '../../../tools/utils/stringUtils';\nimport { toSessionString, toSessionState, getExpiredSessionState } from '../sessionState';\nimport { SESSION_STORE_KEY } from './sessionStoreStrategy';\nvar LOCAL_STORAGE_TEST_KEY = '_dd_test_';\nexport function selectLocalStorageStrategy() {\n  try {\n    var id = generateUUID();\n    var testKey = \"\".concat(LOCAL_STORAGE_TEST_KEY).concat(id);\n    localStorage.setItem(testKey, id);\n    var retrievedId = localStorage.getItem(testKey);\n    localStorage.removeItem(testKey);\n    return id === retrievedId ? {\n      type: 'LocalStorage'\n    } : undefined;\n  } catch (e) {\n    return undefined;\n  }\n}\nexport function initLocalStorageStrategy() {\n  return {\n    isLockEnabled: false,\n    persistSession: persistInLocalStorage,\n    retrieveSession: retrieveSessionFromLocalStorage,\n    expireSession: expireSessionFromLocalStorage\n  };\n}\nfunction persistInLocalStorage(sessionState) {\n  localStorage.setItem(SESSION_STORE_KEY, toSessionString(sessionState));\n}\nfunction retrieveSessionFromLocalStorage() {\n  var sessionString = localStorage.getItem(SESSION_STORE_KEY);\n  return toSessionState(sessionString);\n}\nfunction expireSessionFromLocalStorage() {\n  persistInLocalStorage(getExpiredSessionState());\n}","map":{"version":3,"names":["generateUUID","toSessionString","toSessionState","getExpiredSessionState","SESSION_STORE_KEY","LOCAL_STORAGE_TEST_KEY","selectLocalStorageStrategy","id","testKey","concat","localStorage","setItem","retrievedId","getItem","removeItem","type","undefined","e","initLocalStorageStrategy","isLockEnabled","persistSession","persistInLocalStorage","retrieveSession","retrieveSessionFromLocalStorage","expireSession","expireSessionFromLocalStorage","sessionState","sessionString"],"sources":["D:\\edu'\\Spritle\\spritle\\node_modules\\@datadog\\browser-core\\src\\domain\\session\\storeStrategies\\sessionInLocalStorage.ts"],"sourcesContent":["import { generateUUID } from '../../../tools/utils/stringUtils'\nimport type { SessionState } from '../sessionState'\nimport { toSessionString, toSessionState, getExpiredSessionState } from '../sessionState'\nimport type { SessionStoreStrategy, SessionStoreStrategyType } from './sessionStoreStrategy'\nimport { SESSION_STORE_KEY } from './sessionStoreStrategy'\n\nconst LOCAL_STORAGE_TEST_KEY = '_dd_test_'\n\nexport function selectLocalStorageStrategy(): SessionStoreStrategyType | undefined {\n  try {\n    const id = generateUUID()\n    const testKey = `${LOCAL_STORAGE_TEST_KEY}${id}`\n    localStorage.setItem(testKey, id)\n    const retrievedId = localStorage.getItem(testKey)\n    localStorage.removeItem(testKey)\n    return id === retrievedId ? { type: 'LocalStorage' } : undefined\n  } catch (e) {\n    return undefined\n  }\n}\n\nexport function initLocalStorageStrategy(): SessionStoreStrategy {\n  return {\n    isLockEnabled: false,\n    persistSession: persistInLocalStorage,\n    retrieveSession: retrieveSessionFromLocalStorage,\n    expireSession: expireSessionFromLocalStorage,\n  }\n}\n\nfunction persistInLocalStorage(sessionState: SessionState) {\n  localStorage.setItem(SESSION_STORE_KEY, toSessionString(sessionState))\n}\n\nfunction retrieveSessionFromLocalStorage(): SessionState {\n  const sessionString = localStorage.getItem(SESSION_STORE_KEY)\n  return toSessionState(sessionString)\n}\n\nfunction expireSessionFromLocalStorage() {\n  persistInLocalStorage(getExpiredSessionState())\n}\n"],"mappings":"AAAA,SAASA,YAAY,QAAQ,kCAAkC;AAE/D,SAASC,eAAe,EAAEC,cAAc,EAAEC,sBAAsB,QAAQ,iBAAiB;AAEzF,SAASC,iBAAiB,QAAQ,wBAAwB;AAE1D,IAAMC,sBAAsB,GAAG,WAAW;AAE1C,OAAM,SAAUC,0BAA0BA,CAAA;EACxC,IAAI;IACF,IAAMC,EAAE,GAAGP,YAAY,EAAE;IACzB,IAAMQ,OAAO,GAAG,GAAAC,MAAA,CAAGJ,sBAAsB,EAAAI,MAAA,CAAGF,EAAE,CAAE;IAChDG,YAAY,CAACC,OAAO,CAACH,OAAO,EAAED,EAAE,CAAC;IACjC,IAAMK,WAAW,GAAGF,YAAY,CAACG,OAAO,CAACL,OAAO,CAAC;IACjDE,YAAY,CAACI,UAAU,CAACN,OAAO,CAAC;IAChC,OAAOD,EAAE,KAAKK,WAAW,GAAG;MAAEG,IAAI,EAAE;IAAc,CAAE,GAAGC,SAAS;EAClE,CAAC,CAAC,OAAOC,CAAC,EAAE;IACV,OAAOD,SAAS;EAClB;AACF;AAEA,OAAM,SAAUE,wBAAwBA,CAAA;EACtC,OAAO;IACLC,aAAa,EAAE,KAAK;IACpBC,cAAc,EAAEC,qBAAqB;IACrCC,eAAe,EAAEC,+BAA+B;IAChDC,aAAa,EAAEC;GAChB;AACH;AAEA,SAASJ,qBAAqBA,CAACK,YAA0B;EACvDhB,YAAY,CAACC,OAAO,CAACP,iBAAiB,EAAEH,eAAe,CAACyB,YAAY,CAAC,CAAC;AACxE;AAEA,SAASH,+BAA+BA,CAAA;EACtC,IAAMI,aAAa,GAAGjB,YAAY,CAACG,OAAO,CAACT,iBAAiB,CAAC;EAC7D,OAAOF,cAAc,CAACyB,aAAa,CAAC;AACtC;AAEA,SAASF,6BAA6BA,CAAA;EACpCJ,qBAAqB,CAAClB,sBAAsB,EAAE,CAAC;AACjD","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
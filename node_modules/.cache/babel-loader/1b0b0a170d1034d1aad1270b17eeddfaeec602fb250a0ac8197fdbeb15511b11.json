{"ast":null,"code":"import { elapsed } from '@datadog/browser-core';\nimport { waitPageActivityEnd } from '../../waitPageActivityEnd';\nexport function trackLoadingTime(lifeCycle, domMutationObservable, configuration, loadType, viewStart, callback) {\n  var isWaitingForLoadEvent = loadType === \"initial_load\" /* ViewLoadingType.INITIAL_LOAD */;\n  var isWaitingForActivityLoadingTime = true;\n  var loadingTimeCandidates = [];\n  function invokeCallbackIfAllCandidatesAreReceived() {\n    if (!isWaitingForActivityLoadingTime && !isWaitingForLoadEvent && loadingTimeCandidates.length > 0) {\n      callback(Math.max.apply(Math, loadingTimeCandidates));\n    }\n  }\n  var stop = waitPageActivityEnd(lifeCycle, domMutationObservable, configuration, function (event) {\n    if (isWaitingForActivityLoadingTime) {\n      isWaitingForActivityLoadingTime = false;\n      if (event.hadActivity) {\n        loadingTimeCandidates.push(elapsed(viewStart.timeStamp, event.end));\n      }\n      invokeCallbackIfAllCandidatesAreReceived();\n    }\n  }).stop;\n  return {\n    stop: stop,\n    setLoadEvent: function (loadEvent) {\n      if (isWaitingForLoadEvent) {\n        isWaitingForLoadEvent = false;\n        loadingTimeCandidates.push(loadEvent);\n        invokeCallbackIfAllCandidatesAreReceived();\n      }\n    }\n  };\n}","map":{"version":3,"names":["elapsed","waitPageActivityEnd","trackLoadingTime","lifeCycle","domMutationObservable","configuration","loadType","viewStart","callback","isWaitingForLoadEvent","isWaitingForActivityLoadingTime","loadingTimeCandidates","invokeCallbackIfAllCandidatesAreReceived","length","Math","max","apply","stop","event","hadActivity","push","timeStamp","end","setLoadEvent","loadEvent"],"sources":["D:\\edu'\\Spritle\\spritle\\node_modules\\@datadog\\browser-rum-core\\src\\domain\\view\\viewMetrics\\trackLoadingTime.ts"],"sourcesContent":["import type { ClocksState, Duration, Observable } from '@datadog/browser-core'\nimport { elapsed } from '@datadog/browser-core'\nimport { waitPageActivityEnd } from '../../waitPageActivityEnd'\nimport type { RumConfiguration } from '../../configuration'\nimport type { LifeCycle } from '../../lifeCycle'\nimport { ViewLoadingType } from '../../../rawRumEvent.types'\n\nexport function trackLoadingTime(\n  lifeCycle: LifeCycle,\n  domMutationObservable: Observable<void>,\n  configuration: RumConfiguration,\n  loadType: ViewLoadingType,\n  viewStart: ClocksState,\n  callback: (loadingTime: Duration) => void\n) {\n  let isWaitingForLoadEvent = loadType === ViewLoadingType.INITIAL_LOAD\n  let isWaitingForActivityLoadingTime = true\n  const loadingTimeCandidates: Duration[] = []\n\n  function invokeCallbackIfAllCandidatesAreReceived() {\n    if (!isWaitingForActivityLoadingTime && !isWaitingForLoadEvent && loadingTimeCandidates.length > 0) {\n      callback(Math.max(...loadingTimeCandidates) as Duration)\n    }\n  }\n\n  const { stop } = waitPageActivityEnd(lifeCycle, domMutationObservable, configuration, (event) => {\n    if (isWaitingForActivityLoadingTime) {\n      isWaitingForActivityLoadingTime = false\n      if (event.hadActivity) {\n        loadingTimeCandidates.push(elapsed(viewStart.timeStamp, event.end))\n      }\n      invokeCallbackIfAllCandidatesAreReceived()\n    }\n  })\n\n  return {\n    stop,\n    setLoadEvent: (loadEvent: Duration) => {\n      if (isWaitingForLoadEvent) {\n        isWaitingForLoadEvent = false\n        loadingTimeCandidates.push(loadEvent)\n        invokeCallbackIfAllCandidatesAreReceived()\n      }\n    },\n  }\n}\n"],"mappings":"AACA,SAASA,OAAO,QAAQ,uBAAuB;AAC/C,SAASC,mBAAmB,QAAQ,2BAA2B;AAK/D,OAAM,SAAUC,gBAAgBA,CAC9BC,SAAoB,EACpBC,qBAAuC,EACvCC,aAA+B,EAC/BC,QAAyB,EACzBC,SAAsB,EACtBC,QAAyC;EAEzC,IAAIC,qBAAqB,GAAGH,QAAQ;EACpC,IAAII,+BAA+B,GAAG,IAAI;EAC1C,IAAMC,qBAAqB,GAAe,EAAE;EAE5C,SAASC,wCAAwCA,CAAA;IAC/C,IAAI,CAACF,+BAA+B,IAAI,CAACD,qBAAqB,IAAIE,qBAAqB,CAACE,MAAM,GAAG,CAAC,EAAE;MAClGL,QAAQ,CAACM,IAAI,CAACC,GAAG,CAAAC,KAAA,CAARF,IAAI,EAAQH,qBAAqB,CAAa,CAAC;IAC1D;EACF;EAEQ,IAAAM,IAAI,GAAKhB,mBAAmB,CAACE,SAAS,EAAEC,qBAAqB,EAAEC,aAAa,EAAE,UAACa,KAAK;IAC1F,IAAIR,+BAA+B,EAAE;MACnCA,+BAA+B,GAAG,KAAK;MACvC,IAAIQ,KAAK,CAACC,WAAW,EAAE;QACrBR,qBAAqB,CAACS,IAAI,CAACpB,OAAO,CAACO,SAAS,CAACc,SAAS,EAAEH,KAAK,CAACI,GAAG,CAAC,CAAC;MACrE;MACAV,wCAAwC,EAAE;IAC5C;EACF,CAAC,CAAC,CAAAK,IARU;EAUZ,OAAO;IACLA,IAAI,EAAAA,IAAA;IACJM,YAAY,EAAE,SAAAA,CAACC,SAAmB;MAChC,IAAIf,qBAAqB,EAAE;QACzBA,qBAAqB,GAAG,KAAK;QAC7BE,qBAAqB,CAACS,IAAI,CAACI,SAAS,CAAC;QACrCZ,wCAAwC,EAAE;MAC5C;IACF;GACD;AACH","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
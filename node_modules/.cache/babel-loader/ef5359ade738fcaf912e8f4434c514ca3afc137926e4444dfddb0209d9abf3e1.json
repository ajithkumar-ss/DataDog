{"ast":null,"code":"import { DOM_EVENT, throttle, addEventListener } from '@datadog/browser-core';\nimport { getScrollX, getScrollY } from '@datadog/browser-rum-core';\nimport { getEventTarget } from '../eventsUtils';\nimport { getNodePrivacyLevel } from '../privacy';\nimport { getSerializedNodeId, hasSerializedNode } from '../serialization';\nimport { IncrementalSource } from '../../../types';\nimport { NodePrivacyLevel } from '../../../constants';\nimport { assembleIncrementalSnapshot } from '../assembly';\nvar SCROLL_OBSERVER_THRESHOLD = 100;\nexport function trackScroll(configuration, scrollCb, elementsScrollPositions, target) {\n  if (target === void 0) {\n    target = document;\n  }\n  var _a = throttle(function (event) {\n      var target = getEventTarget(event);\n      if (!target || getNodePrivacyLevel(target, configuration.defaultPrivacyLevel) === NodePrivacyLevel.HIDDEN || !hasSerializedNode(target)) {\n        return;\n      }\n      var id = getSerializedNodeId(target);\n      var scrollPositions = target === document ? {\n        scrollTop: getScrollY(),\n        scrollLeft: getScrollX()\n      } : {\n        scrollTop: Math.round(target.scrollTop),\n        scrollLeft: Math.round(target.scrollLeft)\n      };\n      elementsScrollPositions.set(target, scrollPositions);\n      scrollCb(assembleIncrementalSnapshot(IncrementalSource.Scroll, {\n        id: id,\n        x: scrollPositions.scrollLeft,\n        y: scrollPositions.scrollTop\n      }));\n    }, SCROLL_OBSERVER_THRESHOLD),\n    updatePosition = _a.throttled,\n    cancelThrottle = _a.cancel;\n  var removeListener = addEventListener(configuration, target, DOM_EVENT.SCROLL, updatePosition, {\n    capture: true,\n    passive: true\n  }).stop;\n  return {\n    stop: function () {\n      removeListener();\n      cancelThrottle();\n    }\n  };\n}","map":{"version":3,"names":["DOM_EVENT","throttle","addEventListener","getScrollX","getScrollY","getEventTarget","getNodePrivacyLevel","getSerializedNodeId","hasSerializedNode","IncrementalSource","NodePrivacyLevel","assembleIncrementalSnapshot","SCROLL_OBSERVER_THRESHOLD","trackScroll","configuration","scrollCb","elementsScrollPositions","target","document","_a","event","defaultPrivacyLevel","HIDDEN","id","scrollPositions","scrollTop","scrollLeft","Math","round","set","Scroll","x","y","updatePosition","throttled","cancelThrottle","cancel","removeListener","SCROLL","capture","passive","stop"],"sources":["D:\\edu'\\Spritle\\spritle\\node_modules\\@datadog\\browser-rum\\src\\domain\\record\\trackers\\trackScroll.ts"],"sourcesContent":["import { DOM_EVENT, throttle, addEventListener } from '@datadog/browser-core'\nimport type { RumConfiguration } from '@datadog/browser-rum-core'\nimport { getScrollX, getScrollY } from '@datadog/browser-rum-core'\nimport type { ElementsScrollPositions } from '../elementsScrollPositions'\nimport { getEventTarget } from '../eventsUtils'\nimport { getNodePrivacyLevel } from '../privacy'\nimport { getSerializedNodeId, hasSerializedNode } from '../serialization'\nimport { IncrementalSource } from '../../../types'\nimport type { BrowserIncrementalSnapshotRecord, ScrollData } from '../../../types'\nimport { NodePrivacyLevel } from '../../../constants'\nimport { assembleIncrementalSnapshot } from '../assembly'\nimport type { Tracker } from './types'\n\nconst SCROLL_OBSERVER_THRESHOLD = 100\n\nexport type ScrollCallback = (incrementalSnapshotRecord: BrowserIncrementalSnapshotRecord) => void\n\nexport function trackScroll(\n  configuration: RumConfiguration,\n  scrollCb: ScrollCallback,\n  elementsScrollPositions: ElementsScrollPositions,\n  target: Document | ShadowRoot = document\n): Tracker {\n  const { throttled: updatePosition, cancel: cancelThrottle } = throttle((event: Event) => {\n    const target = getEventTarget(event) as HTMLElement | Document\n    if (\n      !target ||\n      getNodePrivacyLevel(target, configuration.defaultPrivacyLevel) === NodePrivacyLevel.HIDDEN ||\n      !hasSerializedNode(target)\n    ) {\n      return\n    }\n    const id = getSerializedNodeId(target)\n    const scrollPositions =\n      target === document\n        ? {\n            scrollTop: getScrollY(),\n            scrollLeft: getScrollX(),\n          }\n        : {\n            scrollTop: Math.round((target as HTMLElement).scrollTop),\n            scrollLeft: Math.round((target as HTMLElement).scrollLeft),\n          }\n    elementsScrollPositions.set(target, scrollPositions)\n    scrollCb(\n      assembleIncrementalSnapshot<ScrollData>(IncrementalSource.Scroll, {\n        id,\n        x: scrollPositions.scrollLeft,\n        y: scrollPositions.scrollTop,\n      })\n    )\n  }, SCROLL_OBSERVER_THRESHOLD)\n\n  const { stop: removeListener } = addEventListener(configuration, target, DOM_EVENT.SCROLL, updatePosition, {\n    capture: true,\n    passive: true,\n  })\n\n  return {\n    stop: () => {\n      removeListener()\n      cancelThrottle()\n    },\n  }\n}\n"],"mappings":"AAAA,SAASA,SAAS,EAAEC,QAAQ,EAAEC,gBAAgB,QAAQ,uBAAuB;AAE7E,SAASC,UAAU,EAAEC,UAAU,QAAQ,2BAA2B;AAElE,SAASC,cAAc,QAAQ,gBAAgB;AAC/C,SAASC,mBAAmB,QAAQ,YAAY;AAChD,SAASC,mBAAmB,EAAEC,iBAAiB,QAAQ,kBAAkB;AACzE,SAASC,iBAAiB,QAAQ,gBAAgB;AAElD,SAASC,gBAAgB,QAAQ,oBAAoB;AACrD,SAASC,2BAA2B,QAAQ,aAAa;AAGzD,IAAMC,yBAAyB,GAAG,GAAG;AAIrC,OAAM,SAAUC,WAAWA,CACzBC,aAA+B,EAC/BC,QAAwB,EACxBC,uBAAgD,EAChDC,MAAwC;EAAxC,IAAAA,MAAA;IAAAA,MAAA,GAAAC,QAAwC;EAAA;EAElC,IAAAC,EAAA,GAAwDlB,QAAQ,CAAC,UAACmB,KAAY;MAClF,IAAMH,MAAM,GAAGZ,cAAc,CAACe,KAAK,CAA2B;MAC9D,IACE,CAACH,MAAM,IACPX,mBAAmB,CAACW,MAAM,EAAEH,aAAa,CAACO,mBAAmB,CAAC,KAAKX,gBAAgB,CAACY,MAAM,IAC1F,CAACd,iBAAiB,CAACS,MAAM,CAAC,EAC1B;QACA;MACF;MACA,IAAMM,EAAE,GAAGhB,mBAAmB,CAACU,MAAM,CAAC;MACtC,IAAMO,eAAe,GACnBP,MAAM,KAAKC,QAAQ,GACf;QACEO,SAAS,EAAErB,UAAU,EAAE;QACvBsB,UAAU,EAAEvB,UAAU;OACvB,GACD;QACEsB,SAAS,EAAEE,IAAI,CAACC,KAAK,CAAEX,MAAsB,CAACQ,SAAS,CAAC;QACxDC,UAAU,EAAEC,IAAI,CAACC,KAAK,CAAEX,MAAsB,CAACS,UAAU;OAC1D;MACPV,uBAAuB,CAACa,GAAG,CAACZ,MAAM,EAAEO,eAAe,CAAC;MACpDT,QAAQ,CACNJ,2BAA2B,CAAaF,iBAAiB,CAACqB,MAAM,EAAE;QAChEP,EAAE,EAAAA,EAAA;QACFQ,CAAC,EAAEP,eAAe,CAACE,UAAU;QAC7BM,CAAC,EAAER,eAAe,CAACC;OACpB,CAAC,CACH;IACH,CAAC,EAAEb,yBAAyB,CAAC;IA5BVqB,cAAc,GAAAd,EAAA,CAAAe,SAAA;IAAUC,cAAc,GAAAhB,EAAA,CAAAiB,MA4B5B;EAErB,IAAMC,cAAc,GAAKnC,gBAAgB,CAACY,aAAa,EAAEG,MAAM,EAAEjB,SAAS,CAACsC,MAAM,EAAEL,cAAc,EAAE;IACzGM,OAAO,EAAE,IAAI;IACbC,OAAO,EAAE;GACV,CAAC,CAAAC,IAH0B;EAK5B,OAAO;IACLA,IAAI,EAAE,SAAAA,CAAA;MACJJ,cAAc,EAAE;MAChBF,cAAc,EAAE;IAClB;GACD;AACH","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
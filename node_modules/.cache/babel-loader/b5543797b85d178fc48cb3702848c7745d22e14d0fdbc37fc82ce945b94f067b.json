{"ast":null,"code":"import { noop, assign, combine, toServerDuration, generateUUID } from '@datadog/browser-core';\nimport { trackClickActions } from './trackClickActions';\nexport function startActionCollection(lifeCycle, domMutationObservable, configuration, pageStateHistory) {\n  lifeCycle.subscribe(1 /* LifeCycleEventType.AUTO_ACTION_COMPLETED */, function (action) {\n    return lifeCycle.notify(12 /* LifeCycleEventType.RAW_RUM_EVENT_COLLECTED */, processAction(action, pageStateHistory));\n  });\n  var actionContexts = {\n    findActionId: noop\n  };\n  if (configuration.trackUserInteractions) {\n    actionContexts = trackClickActions(lifeCycle, domMutationObservable, configuration).actionContexts;\n  }\n  return {\n    addAction: function (action, savedCommonContext) {\n      lifeCycle.notify(12 /* LifeCycleEventType.RAW_RUM_EVENT_COLLECTED */, assign({\n        savedCommonContext: savedCommonContext\n      }, processAction(action, pageStateHistory)));\n    },\n    actionContexts: actionContexts\n  };\n}\nfunction processAction(action, pageStateHistory) {\n  var autoActionProperties = isAutoAction(action) ? {\n    action: {\n      id: action.id,\n      loading_time: toServerDuration(action.duration),\n      frustration: {\n        type: action.frustrationTypes\n      },\n      error: {\n        count: action.counts.errorCount\n      },\n      long_task: {\n        count: action.counts.longTaskCount\n      },\n      resource: {\n        count: action.counts.resourceCount\n      }\n    },\n    _dd: {\n      action: {\n        target: action.target,\n        position: action.position\n      }\n    }\n  } : undefined;\n  var customerContext = !isAutoAction(action) ? action.context : undefined;\n  var actionEvent = combine({\n    action: {\n      id: generateUUID(),\n      target: {\n        name: action.name\n      },\n      type: action.type\n    },\n    date: action.startClocks.timeStamp,\n    type: \"action\" /* RumEventType.ACTION */,\n    view: {\n      in_foreground: pageStateHistory.wasInPageStateAt(\"active\" /* PageState.ACTIVE */, action.startClocks.relative)\n    }\n  }, autoActionProperties);\n  return {\n    customerContext: customerContext,\n    rawRumEvent: actionEvent,\n    startTime: action.startClocks.relative,\n    domainContext: isAutoAction(action) ? {\n      events: action.events\n    } : {}\n  };\n}\nfunction isAutoAction(action) {\n  return action.type !== \"custom\" /* ActionType.CUSTOM */;\n}","map":{"version":3,"names":["noop","assign","combine","toServerDuration","generateUUID","trackClickActions","startActionCollection","lifeCycle","domMutationObservable","configuration","pageStateHistory","subscribe","action","notify","processAction","actionContexts","findActionId","trackUserInteractions","addAction","savedCommonContext","autoActionProperties","isAutoAction","id","loading_time","duration","frustration","type","frustrationTypes","error","count","counts","errorCount","long_task","longTaskCount","resource","resourceCount","_dd","target","position","undefined","customerContext","context","actionEvent","name","date","startClocks","timeStamp","view","in_foreground","wasInPageStateAt","relative","rawRumEvent","startTime","domainContext","events"],"sources":["D:\\edu'\\Spritle\\spritle\\node_modules\\@datadog\\browser-rum-core\\src\\domain\\action\\actionCollection.ts"],"sourcesContent":["import type { ClocksState, Context, Observable } from '@datadog/browser-core'\nimport { noop, assign, combine, toServerDuration, generateUUID } from '@datadog/browser-core'\n\nimport type { RawRumActionEvent } from '../../rawRumEvent.types'\nimport { ActionType, RumEventType } from '../../rawRumEvent.types'\nimport type { LifeCycle, RawRumEventCollectedData } from '../lifeCycle'\nimport { LifeCycleEventType } from '../lifeCycle'\nimport type { RumConfiguration } from '../configuration'\nimport type { CommonContext } from '../contexts/commonContext'\nimport type { PageStateHistory } from '../contexts/pageStateHistory'\nimport { PageState } from '../contexts/pageStateHistory'\nimport type { ActionContexts, ClickAction } from './trackClickActions'\nimport { trackClickActions } from './trackClickActions'\n\nexport type { ActionContexts }\n\nexport interface CustomAction {\n  type: ActionType.CUSTOM\n  name: string\n  startClocks: ClocksState\n  context?: Context\n}\n\nexport type AutoAction = ClickAction\n\nexport function startActionCollection(\n  lifeCycle: LifeCycle,\n  domMutationObservable: Observable<void>,\n  configuration: RumConfiguration,\n  pageStateHistory: PageStateHistory\n) {\n  lifeCycle.subscribe(LifeCycleEventType.AUTO_ACTION_COMPLETED, (action) =>\n    lifeCycle.notify(LifeCycleEventType.RAW_RUM_EVENT_COLLECTED, processAction(action, pageStateHistory))\n  )\n\n  let actionContexts: ActionContexts = { findActionId: noop as () => undefined }\n  if (configuration.trackUserInteractions) {\n    actionContexts = trackClickActions(lifeCycle, domMutationObservable, configuration).actionContexts\n  }\n\n  return {\n    addAction: (action: CustomAction, savedCommonContext?: CommonContext) => {\n      lifeCycle.notify(\n        LifeCycleEventType.RAW_RUM_EVENT_COLLECTED,\n        assign(\n          {\n            savedCommonContext,\n          },\n          processAction(action, pageStateHistory)\n        )\n      )\n    },\n    actionContexts,\n  }\n}\n\nfunction processAction(\n  action: AutoAction | CustomAction,\n  pageStateHistory: PageStateHistory\n): RawRumEventCollectedData<RawRumActionEvent> {\n  const autoActionProperties = isAutoAction(action)\n    ? {\n        action: {\n          id: action.id,\n          loading_time: toServerDuration(action.duration),\n          frustration: {\n            type: action.frustrationTypes,\n          },\n          error: {\n            count: action.counts.errorCount,\n          },\n          long_task: {\n            count: action.counts.longTaskCount,\n          },\n          resource: {\n            count: action.counts.resourceCount,\n          },\n        },\n        _dd: {\n          action: {\n            target: action.target,\n            position: action.position,\n          },\n        },\n      }\n    : undefined\n  const customerContext = !isAutoAction(action) ? action.context : undefined\n  const actionEvent: RawRumActionEvent = combine(\n    {\n      action: {\n        id: generateUUID(),\n        target: {\n          name: action.name,\n        },\n        type: action.type,\n      },\n      date: action.startClocks.timeStamp,\n      type: RumEventType.ACTION as const,\n      view: { in_foreground: pageStateHistory.wasInPageStateAt(PageState.ACTIVE, action.startClocks.relative) },\n    },\n    autoActionProperties\n  )\n\n  return {\n    customerContext,\n    rawRumEvent: actionEvent,\n    startTime: action.startClocks.relative,\n    domainContext: isAutoAction(action) ? { events: action.events } : {},\n  }\n}\n\nfunction isAutoAction(action: AutoAction | CustomAction): action is AutoAction {\n  return action.type !== ActionType.CUSTOM\n}\n"],"mappings":"AACA,SAASA,IAAI,EAAEC,MAAM,EAAEC,OAAO,EAAEC,gBAAgB,EAAEC,YAAY,QAAQ,uBAAuB;AAW7F,SAASC,iBAAiB,QAAQ,qBAAqB;AAavD,OAAM,SAAUC,qBAAqBA,CACnCC,SAAoB,EACpBC,qBAAuC,EACvCC,aAA+B,EAC/BC,gBAAkC;EAElCH,SAAS,CAACI,SAAS,mDAA2C,UAACC,MAAM;IACnE,OAAAL,SAAS,CAACM,MAAM,sDAA6CC,aAAa,CAACF,MAAM,EAAEF,gBAAgB,CAAC,CAAC;EAArG,CAAqG,CACtG;EAED,IAAIK,cAAc,GAAmB;IAAEC,YAAY,EAAEhB;EAAuB,CAAE;EAC9E,IAAIS,aAAa,CAACQ,qBAAqB,EAAE;IACvCF,cAAc,GAAGV,iBAAiB,CAACE,SAAS,EAAEC,qBAAqB,EAAEC,aAAa,CAAC,CAACM,cAAc;EACpG;EAEA,OAAO;IACLG,SAAS,EAAE,SAAAA,CAACN,MAAoB,EAAEO,kBAAkC;MAClEZ,SAAS,CAACM,MAAM,sDAEdZ,MAAM,CACJ;QACEkB,kBAAkB,EAAAA;OACnB,EACDL,aAAa,CAACF,MAAM,EAAEF,gBAAgB,CAAC,CACxC,CACF;IACH,CAAC;IACDK,cAAc,EAAAA;GACf;AACH;AAEA,SAASD,aAAaA,CACpBF,MAAiC,EACjCF,gBAAkC;EAElC,IAAMU,oBAAoB,GAAGC,YAAY,CAACT,MAAM,CAAC,GAC7C;IACEA,MAAM,EAAE;MACNU,EAAE,EAAEV,MAAM,CAACU,EAAE;MACbC,YAAY,EAAEpB,gBAAgB,CAACS,MAAM,CAACY,QAAQ,CAAC;MAC/CC,WAAW,EAAE;QACXC,IAAI,EAAEd,MAAM,CAACe;OACd;MACDC,KAAK,EAAE;QACLC,KAAK,EAAEjB,MAAM,CAACkB,MAAM,CAACC;OACtB;MACDC,SAAS,EAAE;QACTH,KAAK,EAAEjB,MAAM,CAACkB,MAAM,CAACG;OACtB;MACDC,QAAQ,EAAE;QACRL,KAAK,EAAEjB,MAAM,CAACkB,MAAM,CAACK;;KAExB;IACDC,GAAG,EAAE;MACHxB,MAAM,EAAE;QACNyB,MAAM,EAAEzB,MAAM,CAACyB,MAAM;QACrBC,QAAQ,EAAE1B,MAAM,CAAC0B;;;GAGtB,GACDC,SAAS;EACb,IAAMC,eAAe,GAAG,CAACnB,YAAY,CAACT,MAAM,CAAC,GAAGA,MAAM,CAAC6B,OAAO,GAAGF,SAAS;EAC1E,IAAMG,WAAW,GAAsBxC,OAAO,CAC5C;IACEU,MAAM,EAAE;MACNU,EAAE,EAAElB,YAAY,EAAE;MAClBiC,MAAM,EAAE;QACNM,IAAI,EAAE/B,MAAM,CAAC+B;OACd;MACDjB,IAAI,EAAEd,MAAM,CAACc;KACd;IACDkB,IAAI,EAAEhC,MAAM,CAACiC,WAAW,CAACC,SAAS;IAClCpB,IAAI,EAAE;IACNqB,IAAI,EAAE;MAAEC,aAAa,EAAEtC,gBAAgB,CAACuC,gBAAgB,kCAAmBrC,MAAM,CAACiC,WAAW,CAACK,QAAQ;IAAC;GACxG,EACD9B,oBAAoB,CACrB;EAED,OAAO;IACLoB,eAAe,EAAAA,eAAA;IACfW,WAAW,EAAET,WAAW;IACxBU,SAAS,EAAExC,MAAM,CAACiC,WAAW,CAACK,QAAQ;IACtCG,aAAa,EAAEhC,YAAY,CAACT,MAAM,CAAC,GAAG;MAAE0C,MAAM,EAAE1C,MAAM,CAAC0C;IAAM,CAAE,GAAG;GACnE;AACH;AAEA,SAASjC,YAAYA,CAACT,MAAiC;EACrD,OAAOA,MAAM,CAACc,IAAI;AACpB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}